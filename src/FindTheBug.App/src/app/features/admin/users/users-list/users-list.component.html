<div class="users-container">
  <div class="page-header">
    <h2>Users Management</h2>
    <button nz-button nzType="primary" (click)="createUser()">
      <span nz-icon nzType="plus"></span>
      Add User
    </button>
  </div>

  <div class="search-bar">
    <nz-input-group [nzSuffix]="suffixIconSearch">
      <input
        type="text"
        nz-input
        placeholder="Search by name, email, phone, or NID"
        [(ngModel)]="searchText"
        (keyup.enter)="onSearch()"
      />
    </nz-input-group>
    <ng-template #suffixIconSearch>
      <span
        nz-icon
        nzType="search"
        (click)="onSearch()"
        style="cursor: pointer"
      ></span>
    </ng-template>
  </div>

  <nz-table
    #usersTable
    [nzData]="users"
    [nzLoading]="loading"
    [nzFrontPagination]="false"
    [nzTotal]="totalCount"
    [nzPageSize]="pageSize"
    [nzPageIndex]="pageNumber"
    (nzPageIndexChange)="onPageChange($event)"
    (nzPageSizeChange)="onPageSizeChange($event)"
    [nzShowSizeChanger]="true"
    [nzPageSizeOptions]="[10, 20, 50, 100]"
  >
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>NID Number</th>
        <th>Roles</th>
        <th>Status</th>
        <th>Last Login</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td>{{ user.firstName }} {{ user.lastName }}</td>
        <td>{{ user.email || "-" }}</td>
        <td>{{ user.phone || "-" }}</td>
        <td>{{ user.nidNumber || "-" }}</td>
        <td>
          <nz-tag
            *ngFor="let role of user.roles.split(',')"
            [nzColor]="role === 'Admin' ? 'red' : 'blue'"
          >
            {{ role }}
          </nz-tag>
        </td>
        <td>
          <nz-tag [nzColor]="user.isActive ? 'green' : 'default'">
            {{ user.isActive ? "Active" : "Inactive" }}
          </nz-tag>
        </td>
        <td>
          {{ user.lastLoginAt ? (user.lastLoginAt | date : "short") : "Never" }}
        </td>
        <td>
          <button
            nz-button
            nzType="link"
            nzSize="small"
            (click)="viewUser(user.id)"
          >
            <span nz-icon nzType="eye"></span>
          </button>
          <button
            nz-button
            nzType="link"
            nzSize="small"
            (click)="editUser(user.id)"
          >
            <span nz-icon nzType="edit"></span>
          </button>
          <button
            nz-button
            nzType="link"
            nzSize="small"
            nzDanger
            (click)="deleteUser(user)"
          >
            <span nz-icon nzType="delete"></span>
          </button>
        </td>
      </tr>
    </tbody>
  </nz-table>
</div>
