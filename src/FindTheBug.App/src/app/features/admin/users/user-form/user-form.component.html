<div class="form-container">
  <nz-card [nzTitle]="isEditMode ? 'Edit User' : 'Create New User'" [nzLoading]="loading">
    <form nz-form [formGroup]="userForm" (ngSubmit)="onSubmit()" nzLayout="vertical">
      <div class="form-row">
        <nz-form-item class="form-item-half">
          <nz-form-label nzRequired>First Name</nz-form-label>
          <nz-form-control nzErrorTip="Please enter first name">
            <input nz-input formControlName="firstName" placeholder="First Name" />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item class="form-item-half">
          <nz-form-label nzRequired>Last Name</nz-form-label>
          <nz-form-control nzErrorTip="Please enter last name">
            <input nz-input formControlName="lastName" placeholder="Last Name" />
          </nz-form-control>
        </nz-form-item>
      </div>

      <div class="form-row">
        <nz-form-item class="form-item-half">
          <nz-form-label>Email</nz-form-label>
          <nz-form-control nzErrorTip="Please enter a valid email">
            <input nz-input formControlName="email" type="email" placeholder="Email" />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item class="form-item-half">
          <nz-form-label nzRequired>Phone</nz-form-label>
          <nz-form-control nzErrorTip="Please enter phone number">
            <input nz-input formControlName="phone" placeholder="Phone Number" />
          </nz-form-control>
        </nz-form-item>
      </div>

      <div class="form-row">
        <nz-form-item class="form-item-half">
          <nz-form-label>NID Number</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="nidNumber" placeholder="National ID Number" />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item class="form-item-half">
          <nz-form-label [nzRequired]="!isEditMode && userForm.get('allowUserLogin')?.value">Password</nz-form-label>
          <nz-form-control [nzErrorTip]="getPasswordErrorTip()">
            <input
              nz-input
              formControlName="password"
              type="password"
              [placeholder]="getPasswordPlaceholder()"
              />
            </nz-form-control>
          </nz-form-item>
        </div>

        <div class="form-row">
          <nz-form-item class="form-item-half">
            <nz-form-label nzRequired>Roles</nz-form-label>
            <nz-form-control nzErrorTip="Please select at least one role">
              <nz-select
                formControlName="roleIds"
                nzMode="multiple"
                nzPlaceHolder="Select roles"
                [nzLoading]="loadingRoles"
                nzShowSearch
                >
                @for (role of availableRoles; track role) {
                  <nz-option
                    [nzValue]="role.id"
                    [nzLabel]="role.name"
                  ></nz-option>
                }
              </nz-select>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item class="form-item-half">
            <nz-form-label>Active Status</nz-form-label>
            <nz-form-control>
              <nz-switch formControlName="isActive"></nz-switch>
              <span class="status-label">{{ userForm.get('isActive')?.value ? 'Active' : 'Inactive' }}</span>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div class="form-row">
          <nz-form-item class="form-item-half">
            <nz-form-label>Allow User Login</nz-form-label>
            <nz-form-control>
              <nz-switch formControlName="allowUserLogin"></nz-switch>
              <span class="status-label">{{ userForm.get('allowUserLogin')?.value ? 'Allowed' : 'Not Allowed' }}</span>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div class="form-actions">
          <button nz-button nzType="default" (click)="cancel()" [disabled]="submitting">
            Cancel
          </button>
          <button nz-button nzType="primary" type="submit" [nzLoading]="submitting">
            {{ isEditMode ? 'Update' : 'Create' }} User
          </button>
        </div>
      </form>
    </nz-card>
  </div>
